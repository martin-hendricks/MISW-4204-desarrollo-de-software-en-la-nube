# ==============================================================================
# CONFIGURACIÓN DE PERFORMANCE TESTING CON AWS SQS + S3
# ==============================================================================
# Este archivo configura el entorno de pruebas de carga para conectar
# directamente a AWS SQS y S3 (sin Redis, SSH tunnel, Prometheus o Grafana)
# ==============================================================================

# ------------------------------------------------------------------------------
# CONFIGURACIÓN DE AWS SQS (Message Broker)
# ------------------------------------------------------------------------------

AWS_REGION=us-east-1

# URLs de las colas SQS
# Obtén estas URLs ejecutando: ../../deployment/sqs-setup/setup-sqs.sh
# Ejemplo: https://sqs.us-east-1.amazonaws.com/ACCOUNT_ID/anb-video-processing-queue
SQS_QUEUE_URL=
SQS_DLQ_URL=

# Configuración del producer
USE_SQS=true

# ------------------------------------------------------------------------------
# CONFIGURACIÓN DE AWS S3 (Almacenamiento de Videos)
# ------------------------------------------------------------------------------

# Nombre del bucket S3 (debe ser el mismo que usa el worker)
S3_BUCKET_NAME=

# Configuración del producer
USE_S3=true

# ------------------------------------------------------------------------------
# CREDENCIALES DE AWS
# ------------------------------------------------------------------------------

# Para AWS Academy:
#   1. Ve a AWS Details > AWS CLI > Show
#   2. Copia las credenciales (Access Key ID, Secret Access Key, Session Token)
#   3. IMPORTANTE: Las credenciales expiran cada 4 horas, deberás renovarlas

# Para EC2 con IAM Role:
#   - Puedes dejar estos campos vacíos
#   - La instancia obtiene credenciales automáticamente del Instance Profile

AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
AWS_SESSION_TOKEN=

# ------------------------------------------------------------------------------
# CONFIGURACIÓN DE LA API (para JMeter y setup JWT)
# ------------------------------------------------------------------------------

# URL base del backend
# Puede ser:
#   - IP pública del backend: http://3.XXX.XXX.XXX
#   - DNS del ALB: http://your-alb-dns.us-east-1.elb.amazonaws.com
API_BASE_URL=

# Usuario de prueba (será creado automáticamente si no existe)
TEST_USER_EMAIL=performance_test@example.com
TEST_USER_PASSWORD=PerformanceTest123!

# ==============================================================================
# GUÍA DE CONFIGURACIÓN RÁPIDA
# ==============================================================================

# PASO 1: Copiar este archivo
#   cp .env.example .env
#   nano .env

# PASO 2: Configurar AWS SQS
#   a) Ejecuta el script de setup de SQS:
#      cd ../../deployment/sqs-setup
#      ./setup-sqs.sh us-east-1
#
#   b) Copia las URLs generadas (SQS_QUEUE_URL y SQS_DLQ_URL)

# PASO 3: Configurar AWS S3
#   - S3_BUCKET_NAME: Usa el mismo bucket que configuraste para el worker
#   - Ejemplo: anb-video-storage-123456

# PASO 4: Configurar credenciales de AWS
#   Para AWS Academy:
#     - Copia las credenciales desde AWS Details > AWS CLI > Show
#     - Recuerda renovarlas cada 4 horas
#
#   Para EC2 con IAM Role:
#     - Deja las credenciales vacías
#     - Asegúrate de que la instancia tenga el Instance Profile correcto

# PASO 5: Configurar API
#   - API_BASE_URL: URL del backend (ALB o IP pública)
#   - Ejemplo: http://3.XXX.XXX.XXX o http://anb-alb-XXXXX.us-east-1.elb.amazonaws.com

# PASO 6: Levantar servicios
#   docker-compose up -d

# PASO 7: Ejecutar pruebas
#   # Pruebas de worker (producer enviando tareas a SQS)
#   docker exec -it producer python producer.py --num-videos 100 --no-wait
#
#   # Pruebas web (JMeter)
#   docker exec -it jmeter jmeter -n -t /scripts/your_test.jmx -l /scripts/results.jtl

# PASO 8: Monitorear en AWS CloudWatch
#   - Logs: /aws/ec2/anb-backend y /aws/ec2/anb-worker
#   - Métricas: Namespace ANB/Backend y ANB/Worker
#   - Colas SQS: Ve a SQS Console para ver mensajes

# ==============================================================================
# NOTAS IMPORTANTES
# ==============================================================================

# 1. NUNCA subas el archivo .env a Git (ya está en .gitignore)

# 2. Credenciales de AWS Academy expiran cada 4 horas:
#    - Obtén nuevas credenciales de AWS Academy
#    - Actualiza .env
#    - Reinicia el producer: docker-compose restart producer

# 3. Monitoreo ahora en CloudWatch (NO Prometheus/Grafana):
#    - Logs: CloudWatch Logs
#    - Métricas: CloudWatch Metrics
#    - Dashboards: CloudWatch Dashboards

# 4. Ya NO se necesita:
#    - Redis (reemplazado por SQS)
#    - SSH tunnel (misma cuenta AWS)
#    - Prometheus (métricas en CloudWatch)
#    - Grafana (dashboards en CloudWatch)

# ==============================================================================
# CAMBIOS RESPECTO A VERSIÓN ANTERIOR
# ==============================================================================

# REMOVIDO:
# - PROMETHEUS_BACKEND_TARGET (métricas ahora en CloudWatch)
# - PROMETHEUS_WORKER_TARGET (métricas ahora en CloudWatch)
# - GF_SECURITY_ADMIN_USER (Grafana removido)
# - GF_SECURITY_ADMIN_PASSWORD (Grafana removido)
# - BACKEND_PUBLIC_IP (SSH tunnel ya no necesario)
# - BACKEND_SSH_USER (SSH tunnel ya no necesario)
# - BACKEND_SSH_KEY (SSH tunnel ya no necesario)
# - REDIS_URL (Redis ya no necesario)

# AGREGADO:
# - Documentación mejorada
# - Guía de configuración más clara
# - Notas sobre CloudWatch

# ==============================================================================
